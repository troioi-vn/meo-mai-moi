<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icon-32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icon-16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" id="app-manifest" href="/site-light.webmanifest" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
      ;(function () {
        const manifestEl = document.getElementById('app-manifest')
        const themeColorMeta = document.querySelector('meta[name="theme-color"]')
        const mq = matchMedia('(prefers-color-scheme: dark)')

        function updateManifest() {
          // Check localStorage first (app theme), fallback to system preference
          const storedTheme = localStorage.getItem('vite-ui-theme')
          let isDark = false

          if (storedTheme === 'dark') {
            isDark = true
          } else if (storedTheme === 'light') {
            isDark = false
          } else {
            // 'system' or null - use OS preference
            isDark = mq.matches
          }

          manifestEl.href = isDark ? '/site-dark.webmanifest' : '/site-light.webmanifest'
          
          // Update theme-color meta tag
          if (themeColorMeta) {
            themeColorMeta.setAttribute('content', isDark ? '#111827' : '#ffffff')
          }
        }

        // Listen for OS theme changes
        mq.addEventListener('change', updateManifest)

        // Listen for localStorage changes (theme toggle in app)
        window.addEventListener('storage', updateManifest)

        // Initial update
        updateManifest()

        // Expose for theme provider to call
        window.__updateManifest = updateManifest
      })()
    </script>
    <title>Vite + React + TS</title>
  </head>
  <body class="bg-background text-foreground">
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
